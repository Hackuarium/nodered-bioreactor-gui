[{"id":"c5669537.d71768","type":"tab","label":"queryDevice","disabled":false,"info":"**Tab:** Advanced"},{"id":"ab0d3f22.d2997","type":"tab","label":"currentSettings","disabled":false,"info":"**Tab:** Advanced"},{"id":"22b23614.75c2ca","type":"tab","label":"dbHandler","disabled":false,"info":""},{"id":"410091b5.cba5","type":"tab","label":"deviceListHandler","disabled":false,"info":""},{"id":"c55192f2.07661","type":"tab","label":"logsDisplay","disabled":false,"info":""},{"id":"9755adca.c3eda","type":"subflow","name":"setAnswerTopic","info":"Sets the \"flow.topic\" of the parent flow to match the query topic. ","category":"","in":[{"x":60,"y":80,"wires":[{"id":"16e37238.7e311e"}]}],"out":[{"x":300,"y":80,"wires":[{"id":"16e37238.7e311e","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"570a93d6.30b89c","type":"subflow","name":"multiline text","info":"The **msg.payload** must be a long string. It can contain carriage returns. If there is overflow, scrollbars are added.\n\n**msg.title** sets the title of the text box.","category":"","in":[{"x":40,"y":80,"wires":[{"id":"f9f8960f.de5578"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"1013011c.82c3ef","type":"mqtt-broker","z":"","name":"broker","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"2a22f749.6390c8","type":"ui_tab","z":"","name":"Advanced","icon":"dashboard","disabled":false,"hidden":false},{"id":"3b241c9d.d7d464","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#ffe111","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#e0c50a","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#e0c50a","edited":true},"page-titlebar-backgroundColor":{"value":"#e0c50a","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#f6df40","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#e0c50a","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4fc05906.0c6828","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"bioreactors","name":"","usetls":false,"tls":""},{"id":"371271e4.ff0abe","type":"ui_group","z":"","name":"Query device","tab":"2a22f749.6390c8","order":3,"disp":true,"width":"6","collapse":false},{"id":"3d2b6406.9676ac","type":"ui_group","z":"","name":"Current settings","tab":"2a22f749.6390c8","order":2,"disp":true,"width":"6","collapse":false},{"id":"60f23d23.b883c4","type":"ui_group","z":"","name":"Select device","tab":"2a22f749.6390c8","order":1,"disp":true,"width":"6","collapse":false},{"id":"af83a5be.9d0fc8","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"bioreactors_hour","name":"","usetls":false,"tls":""},{"id":"b233375f.9317a8","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"bioreactors_day","name":"","usetls":false,"tls":""},{"id":"6276e35b.2b6c9c","type":"mqtt out","z":"c5669537.d71768","name":"","topic":"","qos":"","retain":"","broker":"1013011c.82c3ef","x":590,"y":260,"wires":[]},{"id":"8e0837cc.c1f918","type":"mqtt in","z":"c5669537.d71768","name":"","topic":"bioreactor/a/#","qos":"2","datatype":"auto","broker":"1013011c.82c3ef","x":130,"y":380,"wires":[["622228dd.0d92f8"]]},{"id":"96240e96.f99f4","type":"ui_text_input","z":"c5669537.d71768","name":"command","label":"Command","tooltip":"","group":"371271e4.ff0abe","order":1,"width":0,"height":0,"passthru":false,"mode":"text","delay":"0","topic":"","x":120,"y":260,"wires":[["94cbc66c.76d958"]]},{"id":"16e37238.7e311e","type":"function","z":"9755adca.c3eda","name":"setAnswerTopic","func":"let array = msg.topic.split('/');\narray[1]= 'a';\nlet answerTopic = array.join('/');\n\nflow.set(\"$parent.topic\", answerTopic);\n\nmsg.answerTopic = answerTopic;\n\nmsg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":80,"wires":[[]]},{"id":"f9f8960f.de5578","type":"ui_template","z":"570a93d6.30b89c","group":"371271e4.ff0abe","name":"Multiline text","order":2,"width":0,"height":0,"format":"<style>\n    #mylog {\n        min-height: 300px;\n        padding: 0;\n        white-space: pre;\n    }\n</style>\n\n<div><h3 ng-bind=\"msg.title\"></h3></div>\n\n<div id=\"mylog\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    <!-- payload will go here -->\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":150,"y":80,"wires":[[]]},{"id":"622228dd.0d92f8","type":"switch","z":"c5669537.d71768","name":"filter topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"topic","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":380,"wires":[["3871b0fe.61af9","6ac88092.5ae6"]]},{"id":"3871b0fe.61af9","type":"debug","z":"c5669537.d71768","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":360,"wires":[]},{"id":"21ca9a59.9693d6","type":"subflow:9755adca.c3eda","z":"c5669537.d71768","name":"","env":[],"x":420,"y":260,"wires":[["6276e35b.2b6c9c","93c8ec3a.c35c7"]]},{"id":"93c8ec3a.c35c7","type":"debug","z":"c5669537.d71768","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":600,"y":220,"wires":[]},{"id":"94cbc66c.76d958","type":"function","z":"c5669537.d71768","name":"setTopic","func":"let cmd = msg.payload;\n\nlet id = global.get('advanced.currentDevice');\n\nif (cmd !== '') {\n    msg.topic = `bioreactor/q/${id}/${cmd}`;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":260,"wires":[["21ca9a59.9693d6"]]},{"id":"fe8a5701.0971d8","type":"mqtt out","z":"22b23614.75c2ca","name":"","topic":"","qos":"","retain":"","broker":"1013011c.82c3ef","x":650,"y":260,"wires":[]},{"id":"fdd6394.b294ac8","type":"mqtt in","z":"22b23614.75c2ca","name":"","topic":"bioreactor/a/#","qos":"2","datatype":"auto","broker":"1013011c.82c3ef","x":90,"y":400,"wires":[["e85a9e1f.065c9"]]},{"id":"ea5ea00.d6a596","type":"debug","z":"22b23614.75c2ca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":380,"wires":[]},{"id":"e9885fd1.f821a","type":"function","z":"22b23614.75c2ca","name":"parseMultilog","func":"const LegoinoUtil = global.get('LegoinoUtil');\n\nlet parts = msg.topic.split('/');\nmsg.deviceId = parts[2];\n\n// checking that topic is answer to command queries\nif (parts.length !== 4) return;\n\nlet data = LegoinoUtil.parseMultilog(msg.payload, {\n    kind: 'OpenBio',\n    parameterLabel: true,\n    parameterInfo: false,\n    parametersArray: false,\n    flatten: true\n  });\n\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":400,"wires":[["f23c470d.dad1f8"]]},{"id":"e85a9e1f.065c9","type":"switch","z":"22b23614.75c2ca","name":"filter topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"topic","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":240,"y":400,"wires":[["e9885fd1.f821a"]]},{"id":"ae061b5f.fbae68","type":"debug","z":"22b23614.75c2ca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":440,"y":220,"wires":[]},{"id":"ac8535d6.06a1e8","type":"subflow:9755adca.c3eda","z":"22b23614.75c2ca","name":"","x":460,"y":260,"wires":[["fe8a5701.0971d8"]]},{"id":"5370f8a4.943d88","type":"function","z":"22b23614.75c2ca","name":"setTopic","func":"let startLog = msg.payload[0].last + 1;\n\nmsg.topic = `bioreactor/q/${msg.deviceId}/lm${startLog}`;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":260,"y":220,"wires":[["ac8535d6.06a1e8","ae061b5f.fbae68"]]},{"id":"e8db3f7a.654f6","type":"inject","z":"22b23614.75c2ca","name":"query last log","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"onceDelay":"0.2","x":120,"y":100,"wires":[["b4d7493a.c21da8"]]},{"id":"b393ac06.23f5f","type":"influxdb out","z":"22b23614.75c2ca","influxdb":"4fc05906.0c6828","name":"","measurement":"","precision":"","retentionPolicy":"","x":680,"y":460,"wires":[]},{"id":"f23c470d.dad1f8","type":"function","z":"22b23614.75c2ca","name":"formatDbEntry","func":"msg.measurement = `bio_${msg.deviceId}`;\n\nmsg.payload = msg.payload.map(entry => formatEntry(entry));\n\nreturn msg;\n\nfunction formatEntry(entry) {\n    entry.time = entry.epoch;\n    delete entry.epoch;\n    delete entry.deviceId;\n    return [entry];\n}","outputs":1,"noerr":0,"x":560,"y":400,"wires":[["ea5ea00.d6a596","b393ac06.23f5f","fa1c7f56.eb2ca"]]},{"id":"7ffe98aa.c60f58","type":"inject","z":"410091b5.cba5","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":60,"wires":[["256ab39c.1a007c"]]},{"id":"c748e9ab.a30f88","type":"change","z":"410091b5.cba5","name":"","rules":[{"t":"set","p":"deviceList","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":380,"wires":[[]]},{"id":"6ac88092.5ae6","type":"change","z":"c5669537.d71768","name":"","rules":[{"t":"set","p":"title","pt":"msg","to":"Answer","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":400,"wires":[["5c5917cc.840a68"]]},{"id":"5c5917cc.840a68","type":"ui_template","z":"c5669537.d71768","group":"371271e4.ff0abe","name":"Multiline text","order":3,"width":0,"height":0,"format":"<style>\n    #mylog {\n        padding: 0;\n        white-space: pre;\n        min-height: 300px;\n    }\n</style>\n\n<div><h3 ng-bind=\"msg.title\"></h3></div>\n\n<div id=\"mylog\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    <!-- payload will go here -->\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":590,"y":400,"wires":[[]]},{"id":"2cdd2643.caf20a","type":"comment","z":"c5669537.d71768","name":"\"Query device\" group (Advanced)","info":"","x":190,"y":200,"wires":[]},{"id":"943971ed.74976","type":"inject","z":"ab0d3f22.d2997","name":"send command","topic":"","payload":"uc","payloadType":"str","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":120,"wires":[["f55d03ef.d3e82"]]},{"id":"bd7986a.bbba978","type":"mqtt out","z":"ab0d3f22.d2997","name":"","topic":"","qos":"","retain":"","broker":"1013011c.82c3ef","x":670,"y":120,"wires":[]},{"id":"b7a72850.db7518","type":"mqtt in","z":"ab0d3f22.d2997","name":"","topic":"bioreactor/a/#","qos":"2","datatype":"auto","broker":"1013011c.82c3ef","x":110,"y":260,"wires":[["6a7606e.8ba18f8"]]},{"id":"2a61c72c.f7f038","type":"debug","z":"ab0d3f22.d2997","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":200,"wires":[]},{"id":"1a0f9b10.786595","type":"function","z":"ab0d3f22.d2997","name":"parser","func":"const LegoinoUtil = global.get('LegoinoUtil');\n\nlet parts = msg.topic.split('/');\n\n// checking that topic is answer to command queries\nif (parts.length !== 4) return;\n\nlet data = LegoinoUtil.parseCurrentSettings(msg.payload, {\n    kind: 'OpenBio',\n    parameterLabel: true,\n    parameterInfo: true,\n    parametersArray: true,\n    flatten: false\n  });\n\n\n\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":260,"wires":[["2a61c72c.f7f038","92c822a9.629ef","96ed9ea9.b223c","9b8b6c00.b4d3b","d10831b9.0c82d"]]},{"id":"6a7606e.8ba18f8","type":"switch","z":"ab0d3f22.d2997","name":"filter topic","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"topic","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":260,"wires":[["1a0f9b10.786595"]]},{"id":"9438a2c.cdbaa6","type":"debug","z":"ab0d3f22.d2997","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":480,"y":80,"wires":[]},{"id":"bfa2a09.319546","type":"subflow:9755adca.c3eda","z":"ab0d3f22.d2997","name":"","env":[],"x":500,"y":120,"wires":[["bd7986a.bbba978"]]},{"id":"f55d03ef.d3e82","type":"function","z":"ab0d3f22.d2997","name":"setTopic","func":"let cmd = msg.payload;\n\nlet id = global.get('advanced.currentDevice');\n\nif (cmd !== '') {\n    msg.topic = `bioreactor/q/${id}/${cmd}`;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":120,"wires":[["bfa2a09.319546","9438a2c.cdbaa6"]]},{"id":"33eff19b.5d5e2e","type":"ui_table","z":"ab0d3f22.d2997","group":"3d2b6406.9676ac","name":"","order":4,"width":6,"height":9,"columns":[{"field":"name","title":"Setting","width":"55%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"value","title":"Value","width":"25%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"unit","title":"Unit","width":"20%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":730,"y":360,"wires":[]},{"id":"92c822a9.629ef","type":"change","z":"ab0d3f22.d2997","name":"set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.parametersArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":360,"wires":[["33eff19b.5d5e2e"]]},{"id":"a61cb20e.d0466","type":"ui_text","z":"ab0d3f22.d2997","group":"3d2b6406.9676ac","order":1,"width":"0","height":"0","name":"","label":"Epoch:","format":"{{msg.payload}}","layout":"row-center","x":760,"y":240,"wires":[]},{"id":"cf07e7f7.d7d238","type":"ui_text","z":"ab0d3f22.d2997","group":"3d2b6406.9676ac","order":2,"width":"3","height":"1","name":"","label":"Device ID","format":"{{msg.payload}}","layout":"col-center","x":740,"y":280,"wires":[]},{"id":"d4e90c9.9e947f","type":"ui_text","z":"ab0d3f22.d2997","group":"3d2b6406.9676ac","order":3,"width":"3","height":"1","name":"","label":"Device code","format":"{{msg.payload}}","layout":"col-center","x":750,"y":320,"wires":[]},{"id":"96ed9ea9.b223c","type":"change","z":"ab0d3f22.d2997","name":"set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.deviceCode","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":320,"wires":[["d4e90c9.9e947f"]]},{"id":"9b8b6c00.b4d3b","type":"change","z":"ab0d3f22.d2997","name":"set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.deviceId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":280,"wires":[["cf07e7f7.d7d238"]]},{"id":"d10831b9.0c82d","type":"change","z":"ab0d3f22.d2997","name":"set payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.epoch","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":240,"wires":[["a61cb20e.d0466"]]},{"id":"913aa7b7.e28448","type":"comment","z":"ab0d3f22.d2997","name":"\"Current settings\" group (Advanced)","info":"","x":180,"y":60,"wires":[]},{"id":"d2b14f9.71a0eb","type":"ui_dropdown","z":"c5669537.d71768","name":"","label":"","tooltip":"","place":"Select option","group":"60f23d23.b883c4","order":1,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":500,"y":80,"wires":[["f158ebe0.837d08","aaad0e32.3051a","dcbb63e9.a5b95"]]},{"id":"a5ab7f3a.63e06","type":"change","z":"c5669537.d71768","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"deviceList.connected","tot":"global"},{"t":"set","p":"payload","pt":"msg","to":"deviceList.connected[0]","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":80,"wires":[["d2b14f9.71a0eb"]]},{"id":"f158ebe0.837d08","type":"change","z":"c5669537.d71768","name":"","rules":[{"t":"set","p":"advanced.currentDevice","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":80,"wires":[[]]},{"id":"aaad0e32.3051a","type":"debug","z":"c5669537.d71768","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":650,"y":120,"wires":[]},{"id":"29d8f13e.c9f2be","type":"ui_ui_control","z":"c5669537.d71768","name":"","events":"all","x":180,"y":80,"wires":[["a5ab7f3a.63e06"]]},{"id":"399c67ed.f0d1a8","type":"influxdb in","z":"22b23614.75c2ca","influxdb":"4fc05906.0c6828","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":620,"y":140,"wires":[["a0bf4b47.940f28","5370f8a4.943d88"]]},{"id":"cc931c36.d959e","type":"function","z":"22b23614.75c2ca","name":"setQuery","func":"msg.deviceId = msg.payload;\n\nmsg.query = `select last(\"id\") from \"bio_${msg.deviceId}\"`;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":580,"y":100,"wires":[["399c67ed.f0d1a8","26ee51a0.d7e11e"]]},{"id":"e744b588.11eef8","type":"comment","z":"c5669537.d71768","name":"\"Select device\" group (Advanced)","info":"","x":150,"y":40,"wires":[]},{"id":"b4d7493a.c21da8","type":"change","z":"22b23614.75c2ca","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"deviceList.all","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":100,"wires":[["f810f7f3.501fd8"]]},{"id":"f810f7f3.501fd8","type":"split","z":"22b23614.75c2ca","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":450,"y":100,"wires":[["cc931c36.d959e"]]},{"id":"26ee51a0.d7e11e","type":"debug","z":"22b23614.75c2ca","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":40,"wires":[]},{"id":"a0bf4b47.940f28","type":"debug","z":"22b23614.75c2ca","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":810,"y":80,"wires":[]},{"id":"fa1c7f56.eb2ca","type":"debug","z":"22b23614.75c2ca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"measurement","targetType":"msg","x":770,"y":340,"wires":[]},{"id":"dcbb63e9.a5b95","type":"ui_text","z":"c5669537.d71768","group":"60f23d23.b883c4","order":1,"width":0,"height":0,"name":"","label":"Chosen device ID: ","format":"{{msg.payload}}","layout":"row-left","x":700,"y":40,"wires":[]},{"id":"c0ff1f96.d2b8b","type":"comment","z":"22b23614.75c2ca","name":"Format logs and store in correct db measurement","info":"","x":200,"y":360,"wires":[]},{"id":"d34282e9.f37ce","type":"comment","z":"22b23614.75c2ca","name":"Send MQTT query","info":"","x":110,"y":160,"wires":[]},{"id":"1bbcf7ef.020598","type":"comment","z":"22b23614.75c2ca","name":"Create message stream for all connected devices","info":"","x":200,"y":60,"wires":[]},{"id":"256ab39c.1a007c","type":"influxdb in","z":"410091b5.cba5","influxdb":"4fc05906.0c6828","name":"get raw list","query":"show measurements","rawOutput":false,"precision":"","retentionPolicy":"","x":270,"y":60,"wires":[["86dffc05.8f598"]]},{"id":"ea9dcd2a.3b05c","type":"function","z":"410091b5.cba5","name":"setList","func":"\nlet dbDevices = msg.payload.map(i => mapFilter(i));\n\nmsg.payload = {\n    connected: ['9266'],\n    db: dbDevices\n};\n\nreturn msg;\n\nfunction mapFilter(entry) {\n    let parts = entry.name.split('_');\n    if (parts.length >= 2) {\n        return parts[1];\n    }\n}","outputs":1,"noerr":0,"x":390,"y":320,"wires":[["c748e9ab.a30f88","8919f392.970a3"]]},{"id":"8919f392.970a3","type":"debug","z":"410091b5.cba5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":320,"wires":[]},{"id":"86dffc05.8f598","type":"change","z":"410091b5.cba5","name":"","rules":[{"t":"set","p":"raw","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":100,"wires":[["108b0b15.7ba8c5"]]},{"id":"108b0b15.7ba8c5","type":"influxdb in","z":"410091b5.cba5","influxdb":"af83a5be.9d0fc8","name":"get hour list","query":"show measurements","rawOutput":false,"precision":"","retentionPolicy":"","x":490,"y":140,"wires":[["fbe7845e.f33378"]]},{"id":"fbe7845e.f33378","type":"change","z":"410091b5.cba5","name":"","rules":[{"t":"set","p":"hour","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":180,"wires":[["a53fae9d.0169"]]},{"id":"a53fae9d.0169","type":"influxdb in","z":"410091b5.cba5","influxdb":"b233375f.9317a8","name":"get day list","query":"show measurements","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":220,"wires":[["7983084f.3c9888"]]},{"id":"7983084f.3c9888","type":"change","z":"410091b5.cba5","name":"","rules":[{"t":"set","p":"day","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":260,"wires":[[]]}]